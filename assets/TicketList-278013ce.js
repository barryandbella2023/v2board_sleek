import{i as M,b as T}from"./commonApi-cf33a198.js";import{e as a,X as $,_ as C,k as y,A as S,H as I,o as r,J as D,K as B,f as t,c as d,F as w,r as q,t as c,d as n,h as f,P as j,Y as E,S as F,j as k,E as L,L as b,m as z,n as N}from"./index-1223ee3d.js";import{_ as R}from"./BaseModal-86c9f799.js";const g=""+new URL("../img/touxiang.jpg",import.meta.url).href,V=p=>{if(!p)throw new Error(a("ticket.errors.invalidId"));return $({url:"api/v1/user/ticket/fetch",method:"get",params:{id:p}})},A=(p,u)=>{if(!p||!u)throw new Error(a("ticket.errors.replyRequired"));return $({url:"api/v1/user/ticket/reply",method:"post",data:{id:p,message:u}})};const H={class:"flex-1 h-[400px] overflow-y-auto"},K={key:0,class:"flex items-start mb-4"},U={class:"flex-none flex flex-col items-center space-y-1 mr-4"},P={class:"block text-xs text-[var(--theme-text)]"},Y={class:"max-w-[calc(100%-80px)]"},J={class:"bg-indigo-400 text-white p-2 rounded-lg relative"},O={key:1,class:"flex items-start flex-row-reverse mb-4"},X={class:"max-w-[calc(100%-80px)]"},G={class:"bg-indigo-100 text-gray-800 p-2 rounded-lg relative"},Q={key:0,class:"border-t border-[var(--theme-com-item)] pt-4 mt-4"},W={key:0,class:"text-center text-[var(--theme-text)]"},Z={key:1,class:"flex items-center gap-2"},tt=["placeholder"],et={__name:"ChatModal",props:{ticketId:{type:Number,required:!0},onClose:{type:Function,required:!0}},setup(p){const u=p,i=y(null),_=y("");let x=null;const h=async()=>{var l;try{const e=await V(u.ticketId);i.value=e.data.data}catch(e){k(a("ticket.fetchFailed"),(l=e.data)==null?void 0:l.message,400)}},s=async()=>{var l;if(_.value.trim())try{await A(u.ticketId,_.value),_.value="",await h()}catch(e){k(a("common.sendFailed"),(l=e.data)==null?void 0:l.message,400)}},o=()=>{x=setInterval(async()=>{var l;await h(),((l=i.value)==null?void 0:l.status)===1&&clearInterval(x)},1e4)};return S(async()=>{await h(),o()}),I(()=>{x&&clearInterval(x)}),(l,e)=>{var v;return r(),D(R,{title:((v=i.value)==null?void 0:v.subject)||"","gradient-id":"chat-gradient","on-close":u.onClose},{default:B(()=>[t("div",H,[i.value?(r(!0),d(w,{key:0},q(i.value.message,m=>(r(),d(w,{key:m.id},[m.is_me?(r(),d("div",K,[t("div",U,[e[1]||(e[1]=t("img",{class:"rounded-full w-10 h-10",src:g,alt:"客服头像"},null,-1)),t("span",P,c(n(a)("ticket.staff")),1)]),t("div",Y,[t("div",J,[t("div",null,c(m.message),1),e[2]||(e[2]=t("div",{class:"absolute left-0 top-1/2 transform -translate-x-1/2 rotate-45 w-2 h-2 bg-indigo-400"},null,-1))])])])):(r(),d("div",O,[e[4]||(e[4]=t("div",{class:"flex-none flex flex-col items-center space-y-1 ml-4"},[t("img",{class:"rounded-full w-10 h-10",src:g,alt:"用户头像"}),t("span",{class:"block text-xs text-[var(--theme-text)]"},"我")],-1)),t("div",X,[t("div",G,[t("div",null,c(m.message),1),e[3]||(e[3]=t("div",{class:"absolute right-0 top-1/2 transform translate-x-1/2 rotate-45 w-2 h-2 bg-indigo-100"},null,-1))])])]))],64))),128)):f("",!0)]),i.value?(r(),d("div",Q,[i.value.status===1?(r(),d("p",W,c(n(a)("ticket.closedTip")),1)):(r(),d("div",Z,[j(t("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>_.value=m),class:"flex-1 bg-[var(--theme-com-item)] text-[var(--theme-text)] p-3 rounded-lg border-0 outline-0",type:"text",placeholder:n(a)("ticket.inputPlaceholder"),onKeyup:E(s,["enter"])},null,40,tt),[[F,_.value]]),t("button",{onClick:s,class:"text-[var(--theme-text)] hover:opacity-80 transition-opacity p-2"},e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)]))]))])):f("",!0)]),_:1},8,["title","on-close"])}}},st=C(et,[["__scopeId","data-v-8b65ec59"]]),at=p=>{const i=L(st,{ticketId:p,onClose:()=>{b(null,document.getElementById("modal"))}});b(i,document.getElementById("modal"))};const ot={class:"ticket-container"},lt={class:"inline-block min-w-full rounded-lg shadow"},nt={class:"min-w-full leading-normal text-[var(--theme-title)]"},rt={class:"bg-[var(--theme-com)] sticky top-0 z-10"},ct={scope:"col",class:"px-5 py-3 text-sm font-normal text-left uppercase whitespace-nowrap"},it={scope:"col",class:"px-5 py-3 text-sm font-normal text-left uppercase whitespace-nowrap"},dt={scope:"col",class:"px-5 py-3 text-sm font-normal text-left uppercase whitespace-nowrap"},pt={scope:"col",class:"px-5 py-3 text-sm font-normal text-left uppercase whitespace-nowrap"},ut={class:"bg-[var(--theme-com-item)]"},ht={class:"px-5 py-5 text-sm"},mt={class:"flex items-center"},_t={class:"mx-3"},xt={class:"whitespace-nowrap w-[6rem] overflow-hidden overflow-ellipsis"},vt={class:"px-5 py-5 text-sm"},wt={class:"whitespace-nowrap"},ft={class:"px-5 py-5 text-sm"},gt={class:"relative whitespace-nowrap"},yt={class:"px-5 py-5 text-sm"},kt={class:"flex gap-5 items-center"},bt=["onClick"],$t=["onClick"],Ct={__name:"TicketList",setup(p){const u=z(),i=h=>{at(h)},_=async h=>{try{await M(h);const s=await T();u.setTickets(s.data.data)}catch{}},x=h=>{const s=new Date(h*1e3),o=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),e=String(s.getDate()).padStart(2,"0"),v=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0");return`${o}/${l}/${e} ${v}:${m}`};return(h,s)=>(r(),d("div",ot,[t("div",lt,[t("table",nt,[t("thead",rt,[t("tr",null,[t("th",ct,c(n(a)("ticket.table.headers.title")),1),t("th",it,c(n(a)("ticket.table.headers.lastReply")),1),t("th",dt,c(n(a)("ticket.table.headers.status")),1),t("th",pt,c(n(a)("ticket.table.headers.actions")),1)])]),t("tbody",ut,[(r(!0),d(w,null,q(n(u).tickets,o=>(r(),d("tr",{key:o.id},[t("td",ht,[t("div",mt,[s[0]||(s[0]=t("div",{class:"flex-shrink-0"},[t("img",{alt:"profil",src:g,class:"mx-auto object-cover rounded-full h-10 w-10"})],-1)),t("div",_t,[t("p",xt,c(o.subject),1)])])]),t("td",vt,[t("p",wt,c(x(o.updated_at)),1)]),t("td",ft,[t("span",{class:N([o.status===1?"text-red-600 bg-red-200":o.reply_status===1?"text-yellow-600 bg-yellow-200":"text-green-600 bg-green-200","relative inline-block px-3 py-1 font-semibold leading-tight rounded-lg"])},[t("span",gt,c(o.status===1?n(a)("ticket.status.closed"):o.reply_status===1?n(a)("ticket.status.pending"):n(a)("ticket.status.replied")),1)],2)]),t("td",yt,[t("div",kt,[t("button",{class:"whitespace-nowrap cursor-pointer",onClick:l=>i(o.id)},s[1]||(s[1]=[t("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 1792 1792",class:"w-8 h-8 text-stone-300",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"})],-1)]),8,bt),o.status!==1?(r(),d("button",{key:0,onClick:l=>_(o.id),class:"whitespace-nowrap bg-red-400 text-white cursor-pointer px-3 py-1 rounded-lg"},c(n(a)("common.close")),9,$t)):f("",!0)])])]))),128))])])])]))}},St=C(Ct,[["__scopeId","data-v-cef1742b"]]);export{g as _,St as t};
